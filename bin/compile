#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Creating profile.d/stamp.sh"

if [ ! -s $1/hello.txt ]; then
  COMMIT_HASH=`git --git-dir="$1/.git" log -1 --format="%H"`

  pwd
  ls -al /
  ls -al /app/hooks/
  ls -al /app/slug-compiler/
  ls -al /home/group_home/
  env
  echo "git commit: $COMMIT_HASH" | indent
  if [ ! -d $1/.profile.d ]; then
    mkdir $1/.profile.d/
  fi
  echo "!/bin/sh" > $1/.profile.d/stamp.sh
  echo "export COMMIT_HASH=$COMMIT_HASH" >> $1/.profile.d/stamp.sh
fi
